### Prerequisites

Docker
Python3

### Installation
Install the dependencies in a virtual environment. The Python framework chosen is FastAPI
```
python3 -m pip install -r requirements.txt
```
Run the API server
```
fastapi dev main.py
```

Pull the following image from docker hub. In this project we run a local instance of a 
redis key value database store. 
```
docker pull redis/redis-stack
```
To initialize the index schemas, run the following commands in the redis cli tool in the browser:
```
http://localhost:8001/redis-stack/browser
```

```
FT.CREATE index ON JSON PREFIX 1 OWNER: SCHEMA $.name AS name TEXT $.bank_accounts[*] AS bank_account TAG

FT.CREATE account_index ON JSON PREFIX 1 BANK_ACCOUNT: SCHEMA $.balance AS balance NUMERIC $.transfer_history[*] AS transaction_ids TAG SORTABLE

FT.CREATE transaction_index ON JSON PREFIX 1 Transaction: SCHEMA $.details.transaction_type AS type TAG SORTABLE $.details.amount AS amount NUMERIC SORTABLE $.details.timestamp AS timestamp NUMERIC SORTABLE $.details.destination AS destination TAG $.details.origin AS origin TAG
```
The successful creation of the schema returns an "OK"

### API Design
Check comments in the main.py module. The schema can be viewed via the docs:
```
http://127.0.0.1:8000/docs#/
```

### Folder and Code Layout
The code aims to separate the functionality as atomically as possible to ensure that each function
performs a single operation and more complex functions are built from calling those functions.

To ensure code maintainability as the application scales, the classes and functions are separated 
into modules according to their functionality. All models are in the model.py module, exception 
classes in the exception.py module, helper functions in utils.py and database operations in the
database.py file. The entrypoint of the project is in main.py.

### Testing
The definitions of the API tests are documented the tests.py module. To run them, use the following command:
```
pytest -v tests.py
```
If all of the test cases pass, we see the following output logs on the console

```
collected 10 items                                                                                                                            

tests.py::test_new_owner_success PASSED                                                                                                 [ 10%]
tests.py::test_new_owner_invalid_amount PASSED                                                                                          [ 20%]
tests.py::test_new_account_success PASSED                                                                                               [ 30%]
tests.py::test_new_account_invalid_amount PASSED                                                                                        [ 40%]
tests.py::test_transfer_success PASSED                                                                                                  [ 50%]
tests.py::test_transfer_invalid_amount PASSED                                                                                           [ 60%]
tests.py::test_transfer_insufficient_balance PASSED                                                                                     [ 70%]
tests.py::test_account_balance PASSED                                                                                                   [ 80%]
tests.py::test_transfer_history_with_transactions PASSED                                                                                [ 90%]
tests.py::test_transfer_history_no_transactions PASSED                                                                                  [100%]

============================================================= 10 passed in 0.23s ==============================================================
```

### Improvements
1. As the code base gets more complex, it is desirable to separate modules in their own directories.
2. Test Cases can include database operations and utility functions
3. More validation checks should be done to ensure that bank accounts numbers, owner ids, etc are valid
and exist in the database, and whether a bank account actually belongs to an owner.
4. Ideally identifications numbers such as ID and IBAN should be separated from, or partially form
 the primary key of a database. PKs generated by the database should be kept within the application
 and not for external use.
5. Leverage the functionality of redis caching
6. More nuanced responses and status codes
